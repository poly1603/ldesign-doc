<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LDoc Admin</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.prod.js"></script>
  <script src="https://unpkg.com/echarts@5/dist/echarts.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
:root{--primary:#6366f1;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-500:#6b7280;--gray-600:#4b5563;--gray-800:#1f2937;--radius:12px;--shadow:0 4px 6px -1px rgba(0,0,0,0.1)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,sans-serif;background:var(--gray-50);color:var(--gray-800)}
.admin-layout{display:flex;min-height:100vh}
.admin-sidebar{width:260px;background:#fff;border-right:1px solid var(--gray-200);position:fixed;height:100vh;display:flex;flex-direction:column}
.admin-logo{padding:20px 24px;display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--gray-100)}
.admin-logo i{color:var(--primary)}
.admin-logo span{font-size:18px;font-weight:700;color:var(--primary)}
.admin-menu{list-style:none;padding:16px 12px;flex:1}
.admin-menu li{margin-bottom:4px}
.admin-menu a{display:flex;align-items:center;gap:12px;padding:12px 16px;color:var(--gray-600);text-decoration:none;border-radius:10px;font-weight:500}
.admin-menu a:hover{background:var(--gray-100)}
.admin-menu a.router-link-active{background:var(--primary);color:#fff}
.admin-menu i{width:20px;height:20px}
.sidebar-footer{padding:16px 20px;border-top:1px solid var(--gray-100)}
.sidebar-footer a{display:flex;align-items:center;gap:8px;color:var(--gray-500);text-decoration:none;font-size:13px}
.admin-main{flex:1;margin-left:260px;padding:24px 32px}
.page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:28px}
.page-header h1{font-size:24px;font-weight:700;display:flex;align-items:center;gap:12px}
.page-header h1 i{color:var(--primary)}
.page-subtitle{color:var(--gray-500);font-size:14px;margin-top:4px}
.card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;margin-bottom:24px}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--gray-100)}
.card-title{font-size:16px;font-weight:600;display:flex;align-items:center;gap:10px}
.card-title i{color:var(--primary)}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:28px}
.stat-card{background:#fff;border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);position:relative;overflow:hidden}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--primary)}
.stat-card.success::before{background:var(--success)}
.stat-card.warning::before{background:var(--warning)}
.stat-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:16px;background:var(--gray-100)}
.stat-icon i{color:var(--primary)}
.stat-card.success .stat-icon i{color:var(--success)}
.stat-card.warning .stat-icon i{color:var(--warning)}
.stat-value{font-size:32px;font-weight:700;margin-bottom:4px}
.stat-label{color:var(--gray-500);font-size:14px}
.chart-container{height:300px}
.chart-grid{display:grid;grid-template-columns:2fr 1fr;gap:24px}
.form-group{margin-bottom:20px}
.form-label{display:block;font-size:14px;font-weight:500;margin-bottom:8px;color:var(--gray-600)}
.form-input{width:100%;padding:12px 16px;border:1px solid var(--gray-200);border-radius:10px;font-size:14px}
.form-input:focus{outline:none;border-color:var(--primary)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.btn{display:inline-flex;align-items:center;gap:8px;padding:12px 20px;border:none;border-radius:10px;font-size:14px;font-weight:500;cursor:pointer}
.btn i{width:18px;height:18px}
.btn-primary{background:var(--primary);color:#fff}
.btn-secondary{background:var(--gray-100);color:var(--gray-600)}
.btn-danger{background:var(--danger);color:#fff}
.btn-sm{padding:8px 14px;font-size:13px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:12px 16px;text-align:left;border-bottom:1px solid var(--gray-100)}
.table th{font-weight:600;color:var(--gray-600);background:var(--gray-50);font-size:13px}
.toast{position:fixed;bottom:24px;right:24px;background:var(--gray-800);color:#fff;padding:14px 20px;border-radius:10px;z-index:1000}
.toast.success{background:var(--success)}
.toast.error{background:var(--danger)}
.nav-preview{display:flex;gap:12px;padding:16px;background:var(--gray-100);border-radius:10px;margin-bottom:20px}
.nav-preview-item{padding:8px 16px;background:#fff;border-radius:6px;font-size:14px}
.nav-item-card{background:#fff;border:1px solid var(--gray-200);border-radius:10px;padding:16px;margin-bottom:12px;display:flex;align-items:center;gap:16px}
.nav-item-content{flex:1;display:grid;grid-template-columns:1fr 1fr;gap:12px}
.empty-state{text-align:center;padding:60px 20px;color:var(--gray-500)}
.build-log{background:var(--gray-800);border-radius:10px;padding:20px;font-family:monospace;font-size:13px;color:#e5e7eb;max-height:400px;overflow-y:auto}
@media(max-width:768px){.admin-sidebar{display:none}.admin-main{margin-left:0}.stats-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div id="app"></div>
  <script>
const DOCS_PORT = 8878;
const { createApp, ref, computed, onMounted, nextTick } = Vue;
const { createRouter, createWebHistory } = VueRouter;
const initIcons = () => { if (window.lucide) window.lucide.createIcons(); };
const api = {
  async get(url) { return (await fetch(url)).json(); },
  async post(url, data) { return (await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })).json(); },
  async put(url, data) { return (await fetch(url, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })).json(); }
};

const Dashboard = {
  template: `<div>
    <div class="page-header">
      <div><h1><i data-lucide="layout-dashboard"></i> 仪表盘</h1><p class="page-subtitle">站点数据概览</p></div>
      <a :href="docsUrl" target="_blank" class="btn btn-primary"><i data-lucide="external-link"></i> 查看站点</a>
    </div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-icon"><i data-lucide="file-text"></i></div><div class="stat-value">{{ pages.length }}</div><div class="stat-label">文档数量</div></div>
      <div class="stat-card success"><div class="stat-icon"><i data-lucide="folder"></i></div><div class="stat-value">{{ folders }}</div><div class="stat-label">文件夹</div></div>
      <div class="stat-card warning"><div class="stat-icon"><i data-lucide="book-open"></i></div><div class="stat-value">{{ navCount }}</div><div class="stat-label">导航项</div></div>
      <div class="stat-card"><div class="stat-icon"><i data-lucide="sidebar"></i></div><div class="stat-value">{{ sidebarCount }}</div><div class="stat-label">侧边栏项</div></div>
    </div>
    <div class="chart-grid">
      <div class="card"><div class="card-header"><div class="card-title"><i data-lucide="bar-chart-3"></i> 文档分布</div></div><div id="chart-docs" class="chart-container"></div></div>
      <div class="card"><div class="card-header"><div class="card-title"><i data-lucide="pie-chart"></i> 类型占比</div></div><div id="chart-types" class="chart-container"></div></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title"><i data-lucide="clock"></i> 最近更新</div></div>
      <table class="table"><thead><tr><th>文档</th><th>路径</th><th>时间</th></tr></thead>
      <tbody><tr v-for="p in recentPages" :key="p.path"><td><strong>{{ p.title || '无标题' }}</strong></td><td><code>{{ p.path }}</code></td><td>{{ formatDate(p.updatedAt) }}</td></tr>
      <tr v-if="!recentPages.length"><td colspan="3" style="text-align:center;color:#9ca3af">暂无文档</td></tr></tbody></table>
    </div>
  </div>`,
  setup() {
    const pages = ref([]), nav = ref([]), sidebar = ref([]), docsUrl = 'http://localhost:' + DOCS_PORT;
    const folders = computed(() => new Set(pages.value.map(p => p.path.split('/').slice(0,-1).join('/'))).size);
    const navCount = computed(() => nav.value.length);
    const sidebarCount = computed(() => sidebar.value.reduce((sum, g) => sum + (g.items?.length || 0), 0));
    const recentPages = computed(() => [...pages.value].sort((a,b) => new Date(b.updatedAt) - new Date(a.updatedAt)).slice(0, 6));
    const formatDate = d => d ? new Date(d).toLocaleDateString('zh-CN') : '-';
    const initCharts = () => {
      if (typeof echarts === 'undefined') return;
      const c1 = echarts.init(document.getElementById('chart-docs'));
      const fd = {}; pages.value.forEach(p => { const f = p.path.split('/')[0] || '根目录'; fd[f] = (fd[f]||0)+1; });
      c1.setOption({ xAxis: { type: 'category', data: Object.keys(fd) }, yAxis: { type: 'value' }, series: [{ data: Object.values(fd), type: 'bar', itemStyle: { color: '#6366f1', borderRadius: [6,6,0,0] } }], grid: { left: 40, right: 20, top: 20, bottom: 40 } });
      const c2 = echarts.init(document.getElementById('chart-types'));
      c2.setOption({ series: [{ type: 'pie', radius: ['50%','75%'], data: [{ value: pages.value.filter(p=>p.path.endsWith('.md')).length, name: 'Markdown', itemStyle:{color:'#6366f1'} }, { value: pages.value.filter(p=>!p.path.endsWith('.md')).length, name: '其他', itemStyle:{color:'#e5e7eb'} }] }] });
    };
    onMounted(async () => {
      const [pRes, nRes, sRes] = await Promise.all([api.get('/api/pages'), api.get('/api/nav'), api.get('/api/sidebar')]);
      pages.value = pRes.pages || []; nav.value = nRes.nav || []; sidebar.value = Array.isArray(sRes.sidebar) ? sRes.sidebar : [];
      nextTick(() => { initIcons(); setTimeout(initCharts, 100); });
    });
    return { pages, folders, navCount, sidebarCount, recentPages, formatDate, docsUrl };
  }
};

const SiteConfig = {
  template: `<div>
    <div class="page-header">
      <div><h1><i data-lucide="settings"></i> 站点配置</h1><p class="page-subtitle">可视化配置站点信息</p></div>
      <button @click="save" class="btn btn-primary" :disabled="saving"><i data-lucide="save"></i> {{ saving ? '保存中...' : '保存' }}</button>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title"><i data-lucide="globe"></i> 基本信息</div></div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">站点标题</label><input v-model="config.title" class="form-input" placeholder="我的文档"/></div>
        <div class="form-group"><label class="form-label">站点描述</label><input v-model="config.description" class="form-input" placeholder="描述"/></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">语言</label><input v-model="config.lang" class="form-input" placeholder="zh-CN"/></div>
        <div class="form-group"><label class="form-label">基础路径</label><input v-model="config.base" class="form-input" placeholder="/"/></div>
      </div>
    </div>
    <div v-if="toast" :class="['toast', toast.type]">{{ toast.msg }}</div>
  </div>`,
  setup() {
    const config = ref({ title: '', description: '', lang: 'zh-CN', base: '/' }), saving = ref(false), toast = ref(null);
    const showToast = (msg, type='success') => { toast.value = {msg, type}; setTimeout(() => toast.value = null, 3000); };
    onMounted(async () => { const r = await api.get('/api/site'); Object.assign(config.value, r); nextTick(initIcons); });
    const save = async () => { saving.value = true; try { const r = await api.put('/api/site', config.value); showToast(r.success ? '已保存！' : '失败', r.success ? 'success' : 'error'); } catch(e) { showToast('失败', 'error'); } saving.value = false; };
    return { config, saving, toast, save };
  }
};

const NavConfig = {
  template: `<div>
    <div class="page-header">
      <div><h1><i data-lucide="navigation"></i> 导航配置</h1><p class="page-subtitle">配置顶部导航栏</p></div>
      <button @click="add" class="btn btn-primary"><i data-lucide="plus"></i> 添加</button>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title"><i data-lucide="eye"></i> 预览</div></div>
      <div class="nav-preview">
        <div v-for="item in nav" :key="item.text" class="nav-preview-item">{{ item.text }}</div>
        <div v-if="!nav.length" style="color:#9ca3af">暂无</div>
      </div>
    </div>
    <div v-for="(item, i) in nav" :key="i" class="nav-item-card">
      <div class="nav-item-content">
        <div class="form-group" style="margin:0"><label class="form-label" style="font-size:12px">文本</label><input v-model="item.text" class="form-input" placeholder="首页"/></div>
        <div class="form-group" style="margin:0"><label class="form-label" style="font-size:12px">链接</label><input v-model="item.link" class="form-input" placeholder="/"/></div>
      </div>
      <button @click="nav.splice(i,1)" class="btn btn-sm btn-danger"><i data-lucide="trash-2"></i></button>
    </div>
    <div v-if="!nav.length" class="empty-state"><p>暂无导航项</p><button @click="add" class="btn btn-primary"><i data-lucide="plus"></i> 添加</button></div>
  </div>`,
  setup() {
    const nav = ref([]);
    onMounted(async () => { const r = await api.get('/api/nav'); nav.value = r.nav || []; nextTick(initIcons); });
    const add = () => { nav.value.push({text: '新导航', link: '/'}); nextTick(initIcons); };
    return { nav, add };
  }
};

const SidebarConfig = {
  template: `<div>
    <div class="page-header">
      <div><h1><i data-lucide="sidebar"></i> 侧边栏配置</h1><p class="page-subtitle">配置文档侧边栏</p></div>
    </div>
    <div class="card"><p style="color:#6b7280">侧边栏配置功能开发中...</p></div>
  </div>`,
  setup() { onMounted(() => nextTick(initIcons)); return {}; }
};

const DocEditor = {
  template: `<div>
    <div class="page-header">
      <div><h1><i data-lucide="edit-3"></i> 文档编辑</h1><p class="page-subtitle">编辑文档内容</p></div>
    </div>
    <div class="card"><p style="color:#6b7280">文档编辑器开发中...</p></div>
  </div>`,
  setup() { onMounted(() => nextTick(initIcons)); return {}; }
};

const BuildDeploy = {
  template: `<div>
    <div class="page-header"><div><h1><i data-lucide="rocket"></i> 构建部署</h1><p class="page-subtitle">打包和部署文档</p></div></div>
    <div class="card"><p style="color:#6b7280">构建部署功能开发中...</p></div>
  </div>`,
  setup() { onMounted(() => nextTick(initIcons)); return {}; }
};

const routes = [
  { path: '/', component: Dashboard },
  { path: '/site', component: SiteConfig },
  { path: '/nav', component: NavConfig },
  { path: '/sidebar', component: SidebarConfig },
  { path: '/editor', component: DocEditor },
  { path: '/deploy', component: BuildDeploy }
];

const router = createRouter({ history: createWebHistory(), routes });

const App = {
  template: `<div class="admin-layout">
    <aside class="admin-sidebar">
      <div class="admin-logo"><i data-lucide="book-open"></i><span>LDoc Admin</span></div>
      <ul class="admin-menu">
        <li><router-link to="/"><i data-lucide="layout-dashboard"></i> 仪表盘</router-link></li>
        <li><router-link to="/site"><i data-lucide="settings"></i> 站点配置</router-link></li>
        <li><router-link to="/nav"><i data-lucide="navigation"></i> 导航配置</router-link></li>
        <li><router-link to="/sidebar"><i data-lucide="sidebar"></i> 侧边栏配置</router-link></li>
        <li><router-link to="/editor"><i data-lucide="edit-3"></i> 文档编辑</router-link></li>
        <li><router-link to="/deploy"><i data-lucide="rocket"></i> 构建部署</router-link></li>
      </ul>
      <div class="sidebar-footer"><a :href="docsUrl" target="_blank"><i data-lucide="external-link"></i> 查看文档站点</a></div>
    </aside>
    <main class="admin-main"><router-view></router-view></main>
  </div>`,
  setup() {
    const docsUrl = 'http://localhost:' + DOCS_PORT;
    onMounted(() => nextTick(initIcons));
    return { docsUrl };
  }
};

createApp(App).use(router).mount('#app');
</script>
</body>
</html>
